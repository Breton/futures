/*jslint onevar: true, undef: true, newcap: true, regexp: true, plusplus: true, bitwise: true, devel: true, maxerr: 50, indent: 2 *//*global module: true, exports: true, provide: true */var global=global||function(){return this}(),__dirname=__dirname||"";(function(){function f(a,b){a=d(a),global.__REQUIRE_KISS_EXPORTS[a]=b||module.exports,c()}function e(b){var c,e="One of the included scripts requires '"+b+"', which is not loaded. "+"\nTry including '<script src=\""+b+".js\"></script>'.\n";b=d(b),c=global.__REQUIRE_KISS_EXPORTS[b]||global[b];if("undefined"==typeof c&&!a){a=!0,alert(e);throw new Error(e)}return c}function d(a){"./"===a.substr(0,2)&&(a=a.substr(2));return a}function c(){global.module={},global.exports={},global.module.exports=exports}function b(a){module.exports=a||module.exports}"use strict";var a=!1;if(global.require){if(global.provide)return;global.provide=b}else global.__REQUIRE_KISS_EXPORTS=global.__REQUIRE_KISS_EXPORTS||{},global.require=global.require||e,global.provide=global.provide||f,c(),provide("require-kiss")})();var process=process||{};(function(){"use strict",require("require-kiss"),process.EventEmitter=process.EventEmitter||function(){};var a=exports.EventEmitter=process.EventEmitter,b=Array.isArray,c=10;a.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._events.maxListeners=a},a.prototype.emit=function(a){if(a==="error")if(!this._events||!this._events.error||b(this._events.error)&&!this._events.error.length)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var c=this._events[a];if(!c)return!1;if(typeof c=="function"){switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:var d=Array.prototype.slice.call(arguments,1);c.apply(this,d)}return!0}if(b(c)){var d=Array.prototype.slice.call(arguments,1),e=c.slice();for(var f=0,g=e.length;f<g;f++)e[f].apply(this,d);return!0}return!1},a.prototype.addListener=function(a,d){if("function"!=typeof d)throw new Error("addListener only takes instances of Function");this._events||(this._events={}),this.emit("newListener",a,d);if(!this._events[a])this._events[a]=d;else if(b(this._events[a])){if(!this._events[a].warned){var e;this._events.maxListeners!==undefined?e=this._events.maxListeners:e=c,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}this._events[a].push(d)}else this._events[a]=[this._events[a],d];return this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(a,b){function d(){c.removeListener(a,d),b.apply(this,arguments)}var c=this;d.listener=b,c.on(a,d);return this},a.prototype.removeListener=function(a,c){if("function"!=typeof c)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var d=this._events[a];if(b(d)){var e=-1;for(var f=0,g=d.length;f<g;f++)if(d[f]===c||d[f].listener&&d[f].listener===c){e=f;break}if(e<0)return this;d.splice(e,1),d.length==0&&delete this._events[a]}else(d===c||d.listener&&d.listener===c)&&delete this._events[a];return this},a.prototype.removeAllListeners=function(a){a&&this._events&&this._events[a]&&(this._events[a]=null);return this},a.prototype.listeners=function(a){this._events||(this._events={}),this._events[a]||(this._events[a]=[]),b(this._events[a])||(this._events[a]=[this._events[a]]);return this._events[a]},provide("events",module.exports)})();var provide=provide||function(){};(function(){function e(a){return new d(a)}function d(d){function s(a,b){var c={};b.forEach(function(b){c[b]=function(){a[b].apply(a,arguments);return c}});return c}function r(a,b){var c;Object.keys(e).forEach(function(f){var g=e[f];a===g.callback&&(b===g.context||g.context===d)&&(c=g)});return c}function q(){var a={},b={};g=0,Object.keys(e).forEach(function(c){var d=a[g]=e[c];f[c]&&(b[g]=!0),d.id=g,g+=1}),f=b,e=a}function p(){l&&(clearTimeout(l),l=undefined),i>0&&(l=setTimeout(function(){o.deliver(new c(i)),l=undefined},i))}var e={},f={},g=0,h=0,i=0,j,k,l,m=!0,n,o=this;d="undefined"==typeof d?null:d,o.isFuture=b,o.setContext=function(a){d=a},o.setTimeout=function(a){i=a,p()},o.errback=function(){arguments.length<2?o.deliver.call(o,arguments[0]||new Error("`errback` called without Error")):o.deliver.apply(o,arguments)},o.callback=function(){var a=Array.prototype.slice.call(arguments);a.unshift(undefined),o.deliver.apply(o,a)},o.callbackCount=function(){return Object.keys(e).length},o.deliveryCount=function(){return h},o.setAsap=function(a){undefined===a&&(a=!0);if(!0!==a&&!1!==a)throw new Error("Future.setAsap(asap) accepts literal true or false, not "+a);m=a},o.hasCallback=function(){return!!r.apply(o,arguments)},o.removeCallback=function(a,b){var c=r(a,b);c&&(delete e[c.id],f[c.id]=undefined,delete f[c.id]);return o},o.deliver=function(){if(j)throw new Error("`Future().fulfill(err, data, ...)` renders future deliveries useless");var a=Array.prototype.slice.call(arguments);k=a,h+=1,Object.keys(e).forEach(function(b){var c=e[b],d=c.callback,g=c.context;f[b]&&(delete e[b],delete f[b]),d.apply(g,a)}),a[0]&&"FutureTimeout"!==a[0].name&&p();return o},o.fulfill=function(){arguments.length?o.deliver.apply(o,arguments):o.deliver(),j=!0},o.whenever=function(b,c){var i=g,j;if("function"!=typeof b)throw new Error("Future().whenever(callback, [context]): callback must be a function.");if(r(b,c))throw new Error("Future().everytimers is a strict set. Cannot add already subscribed `callback, [context]`.");j=e[i]={id:i,callback:b,context:null===c?null:c||d},m&&h>0&&(j.callback.apply(j.context,k),f[i]&&(delete f[i],delete e[i])),g+=1,g>=a&&q();return o},o.when=function(a,b){f[g]=!0,o.whenever(a,b);return o},n=s(o,["when","whenever"]),o.passable=function(){return n}}function c(a){this.name="FutureTimeout",this.message="timeout "+a+"ms"}function b(a){return a instanceof d}"use strict";var a=Math.pow(2,52);e.isFuture=b,module.exports=e,provide("futures/future")})();var provide=provide||function(){},__dirname=__dirname||"";(function(){function d(a){return new c(a)}function c(b){function l(){var a=g?"when":"whenever";h=!0,d=Array(f.length),e=Array(f.length),f.forEach(function(a,b){a.whenever(function(){var a=Array.prototype.slice.call(arguments);d[b]=a,e[b]||(e[b]=!0,i+=1),k()})})}function k(){var a;!!h&&i===d.length&&(i=0,j.deliver.apply(j,d),d=Array(d.length),e=Array(e.length))}var c=this,d=[],e=[],f=[],g=!1,h=!1,i=0,j=a(b);b=b||null,c.deliverer=function(){var b=a();c.add(b);return b.deliver},c.when=function(){h||l(),j.when.apply(j,arguments)},c.whenever=function(){h||l(),j.whenever.apply(j,arguments)},c.add=function(){if(h)throw new Error("`Join().add(Array<future> | subs1, [subs2, ...])` requires that all additions be completed before the first `when()` or `whenever()`");var a=Array.prototype.slice.call(arguments);a=Array.isArray(a[0])?a[0]:a,a.forEach(function(a){a.whenever||(g=!0);if(!a.when)throw new Error("`Join().add(future)` requires either a promise or future");f.push(a)})}}function b(a){return a instanceof c}"use strict";var a=require((__dirname?__dirname+"/":"futures")+"/future");d.isJoin=b,module.exports=d,provide("futures/join")})();var provide=provide||function(){};(function(){function c(a){return new b(a)}function b(a){function f(){var a=Array.prototype.slice.call(arguments),b=e.shift();d=arguments;b?(a.unshift(f),b.callback.apply(b.context,a)):c=!0}var b=this,c=!0,d,e=[];a=a||null,b.then=function(g,h){if("function"!=typeof g)throw new Error("`Sequence().then(callback [context])` requires that `callback` be a function and that `context` be `null`, an object, or a function");e.push({callback:g,context:null===h?null:h||a,index:e.length}),c&&(c=!1,f.apply(null,d));return b}}function a(a){return a instanceof b}"use strict",c.isSequence=a,module.exports=c,provide("futures/sequence")})();var __dirname=__dirname||"",provide=provide||function(){};(function(){function b(b,c){function e(a,b,e){d.then(function(d){c(d,a,b,e)})}var d=a();b.forEach(e);return d}"use strict";var a=require((__dirname?__dirname+"/":"futures")+"/sequence");module.exports=b,provide("futures/forEachAsync-standalone",module.exports)})(),function(){function b(b,c){function f(){var a="undefined"!=typeof c?c:this,f,g;d.setContext(a);try{g=b.apply(a,arguments)}catch(h){f=h}d.deliver(f,g);return e}var d=a(),e=d.passable();d.setAsap(!1),f.when=e.when,f.whenever=e.whenever;return f}"use strict",require("require-kiss");var a=require((__dirname?__dirname+"/":"futures")+"/future");module.exports=b,provide("futures/asyncify",module.exports)}();var provide=provide||function(){},__dirname=__dirname||"";(function(){function d(c,d,e,f,g){function j(d,e){return function(){var g=Array.prototype.slice.call(arguments),h=a(),j=b();g.unshift(h.deliver),d.apply(f,g),j.then(h.when);return i(c[e],j)}}function i(a,b){function g(a,d){return function(){var e=Array.prototype.slice.call(arguments);b.then(function(){var b=Array.prototype.slice.call(arguments),c=[],g=b.shift();b.forEach(function(a){c.push(a)}),e.forEach(function(a){c.push(a)}),e=undefined,d?(a.apply(f,c),g.apply(null,b)):(c.unshift(g),a.apply(f,c))});return c}}var c={};Object.keys(d).forEach(function(a){c[a]=g(d[a])}),Object.keys(e).forEach(function(a){c[a]=g(e[a],!0)});return c}var h={};"undefined"==typeof f&&(f=null),Object.keys(c).forEach(function(a){h[a]=j(c[a],a)});return h}function c(a,b){"undefined"!=typeof b&&("function"==typeof b.when?b.when(a):"function"==typeof b?b(a):a(b))}"use strict";var a=require((__dirname?__dirname+"/":"futures")+"/future"),b=require((__dirname?__dirname+"/":"futures")+"/sequence");module.exports=d,provide("futures/chainify")})();var provide=provide||function(){},__dirname=__dirname||"";(function(){function f(a){return new e(a)}function e(e){function r(){o=Array.prototype.slice.call(arguments);if("break"===o[0]){o.shift();throw new b}q()}function q(){var a=Math.max(h-(d()-k),0);isNaN(a)&&(a=h);if(!m){if(j&&i>=j){g.deliver(new c(j));return}o.unshift(r),setTimeout(function(){k=d();try{p.apply(e,o),i+=1}catch(a){if(a instanceof b){g.deliver.apply(g,o);return}throw a}},a)}}var f=this,g=a(),h=0,i=0,j=0,k,l,m,n,o,p;f.setMaxLoop=function(a){j=a;return f},f.setWait=function(a){h=a;return f},f.setTimeout=function(a){if(l)throw new Error("Can't set timeout, the loop has already begun!");l=a;var b=setTimeout(function(){m=!0,g.deliver(new Error("LoopTimeout"))},l);g.when(function(){clearTimeout(b)});return f},f.run=function(a){o=Array.prototype.slice.call(arguments),p=a,o[0]=undefined,r.apply(f,o);return f},f.when=g.when,f.whenever=g.whenever}function d(){return(new Date).valueOf()}function c(a){this.name="MaxCountReached",this.message="Loop looped "+a+" times"}function b(){this.name="BreakAsyncLoop",this.message="Normal"}"use strict";var a=require((__dirname?__dirname+"/":"futures")+"/future");module.exports=f,provide("futures/loop")})();var provide=provide||function(){},__dirname=__dirname||"";(function(){function b(){var a="You have upgraded to Futures 2.x. See http://github.com/coolaj86/futures for details.";console.log(a);throw new Error(a)}"use strict";var a;__dirname?a=__dirname:a="futures",module.exports={promise:b,subscription:b,synchronize:b,whilst:b,future:require(a+"/future"),forEachAsync:require(a+"/forEachAsync-standalone"),sequence:require(a+"/sequence"),join:require(a+"/join"),asyncify:require(a+"/asyncify"),loop:require(a+"/loop"),chainify:require(a+"/chainify")},provide("futures")})()